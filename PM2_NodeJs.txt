Pastikan Node.js & npm Terinstall (versi LTS)
=============================================
Install Node.js (metode resmi NodeSource) — paling direkomendasikan
> curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash -
> sudo apt-get install -y nodejs


Install PM2 secara global
==========================
Cara terbaik adalah install global via npm agar bisa dipakai oleh semua aplikasi:
> sudo npm install -g pm2

Cek versi:
> pm2 -v


Pastikan restart otomatis setelah server reboot
> pm2 startup
> pm2 save


Install PM2 di dalam project (optional)
========================================
Tidak wajib, tapi beberapa developer suka meng-lock versi PM2:
> npm install pm2 --save-dev


(Opsional tapi Direkomendasikan) Jalankan PM2 tanpa sudo
==========================================================
Agar PM2 lebih aman dan tidak berjalan sebagai root, lakukan:
sudo chown -R $USER:$USER ~/.pm2



MENJALANKAN NEXT JS
============================

1. Pastikan aplikasi dibuild dulu

Next.js production hanya bisa dijalankan setelah di-build.
> npm install
> npm run build

2. Jalankan menggunakan PM2 (cara paling sederhana)
Karena di package.json kamu sudah ada script:
"start": "next start"

Maka cara termudah menjalankan PM2 adalah:
> pm2 start npm --name "frontend" -- start

Selesai. Aplikasi berjalan di PM2.
Default port = 3000


3. Cara yang lebih rapi: menggunakan ecosystem.config.js

Buat file:
ecosystem.config.js

Isi dengan:
module.exports = {
  apps: [
    {
      name: "frontend",
      script: "npm",
      args: "start",
      env: {
        NODE_ENV: "production",
        PORT: 3000
      }
    }
  ]
};

Jalankan:
> pm2 start ecosystem.config.js

4. Melihat status / log / restart
✔ Lihat status
> pm2 status

✔ Lihat log aplikasi
> pm2 logs frontend

✔ Restart
> pm2 restart frontend


Opsi Lebih Optimal (Sangat Direkomendasikan): Standalone Mode
Untuk Next.js versi baru (13–16), mode standalone membuat output build lebih kecil dan cepat.
Edit next.config.js kamu:
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  turbopack: { root: '.' },
  output: 'standalone'
}
module.exports = nextConfig

Build ulang:
> npm run build

Jalankan dengan PM2:
> pm2 start .next/standalone/server.js --name "frontend"


===========================================================================
next.config.js:
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  output: 'standalone'
};
module.exports = nextConfig;

module.exports = {
  apps: [
    {
      name: "frontend",
      script: ".next/standalone/server.js", // Jalankan file standalone langsung
      cwd: "/home/udicky/arsip_digital/frontend", // root project
      instances: 1, // fork mode, bisa diganti "max" untuk cluster
      exec_mode: "fork",
      autorestart: true, // restart otomatis jika crash
      watch: false, // jangan pakai watch di production
      env: {
        NODE_ENV: "production",
        PORT: 3001 // port aplikasi
      },
      error_file: "/home/udicky/arsip_digital/frontend/.pm2/logs/frontend-error.log",
      out_file: "/home/udicky/arsip_digital/frontend/.pm2/logs/frontend-out.log",
      log_date_format: "YYYY-MM-DD HH:mm:ss"
    }
  ]
};

Start/Jalankan PM2 dengan config baru
> pm2 start ecosystem.config.js

TINDAKAN
-----------
> pm2 stop frontend
> rm -rf .next
> npm run build


=========== Pudin Saepudin.
